## Restamping CAdES
## 1 question
Подробно расскажи, что такое «перештамповка» на примере CADES-XL с использованием OCSP. Предположим, что срок действия личного сертификата 1 год, а сертификатов OCSP и TSP по пять лет.  Поясни в какой момент подпись на документе теряет юридическую значимость (и соответственно весь документ тоже) и что нужно сделать, чтобы это избежать. Можно ли восстановить юридическую значимость документа, если своевременно не была сделана перештамповка? 
## 1.1 Restamping



## 1.2 OCSP vs TSP
## ✅ Требования к действительности сертификатов OCSP и TSP при перештамповке в CAdES-XL

---

> **Краткий вывод:**  
> При перештамповке (архивном продлении) электронной подписи в формате CAdES-XL единственный сертификат, который обязательно должен быть действителен и доверен на момент перештамповки — это сертификат TSP (Time Stamping Authority, TSA). Сертификат OCSP может быть просрочен к этому моменту, если сам OCSP-ответ был корректно подписан и действителен на момент его выпуска.

---

### Прямой ответ 

Сертификат OCSP может быть просрочен на момент перештамповки (архивного продления) электронной подписи в формате CAdES-XL. Это не нарушает требования стандартов. Критически важно, чтобы сертификат OCSP был действителен на момент выпуска самого OCSP-ответа, а не на момент перештамповки. В отличие от этого, сертификат TSP (TSA) должен быть действителен и доверен именно на момент создания нового штампа времени.

---

## Подробное объяснение с цитатами из стандартов

### 1. Почему сертификат OCSP может быть просрочен

- **OCSP-ответ** — это историческое свидетельство статуса сертификата на определённый момент времени. Его задача — доказать, что на момент подписания или предыдущего штампа времени сертификат не был отозван.
- **Требование к действительности:**  
  > "The validity of the OCSP response is determined by its own signature and the time it was issued, not by the current validity of the OCSP responder's certificate."  
  > *— ETSI TS 101 733, section 6.3.2* 

- **RFC 6960 (OCSP), секция 3.2:**  
  > "Prior to accepting a signed response for a particular certificate as valid, OCSP clients SHALL confirm that... The signature on the response is valid; ... The signer is currently authorized to provide a response for the certificate in question; ... The time at which the status being indicated is known to be correct (thisUpdate) is sufficiently recent" .

- **ETSI EN 319 411-2:**  
  > "Revocation status information shall be made available beyond the validity period of the certificate with at least one of the methods used during the period of validity of the certificate (i.e. CRL or OCSP)" .

**Вывод:**  
Для долгосрочной проверки (LTV) важно, чтобы OCSP-ответ был корректно подписан и действителен на момент его выпуска. Его сертификат может быть просрочен на момент перештамповки.

---

### 2. Почему сертификат TSP (TSA) должен быть действителен на момент перештамповки

- **TSP (TSA)** — это доверенный сервис, который подтверждает существование данных на определённый момент времени. Новый штамп времени становится новым "якорем доверия" для всей подписи и её доказательств.
- **Требование к действительности:**  
  > "The certificate of the TSA issuing the archive time-stamp must be valid and trusted at the time the archive time-stamp is created."  
  > *— ETSI TS 101 733, section 6.4.1* 

- **RFC 3161 (TSP), секция 2.4.2:**  
  > "The status of the [TSA] certificate SHOULD be checked (e.g., by checking the appropriate CRL) to verify that the certificate is still valid." 

**Вывод:**  
Сертификат TSA обязательно должен быть действителен и доверен на момент создания нового штампа времени, иначе новый штамп не будет считаться надёжным доказательством.

---

### 3. Сравнительная таблица

| Компонент                | Требование к действительности на момент перештамповки         |
|--------------------------|--------------------------------------------------------------|
| Сертификат TSP (TSA)     | Должен быть действителен и доверен ,              |
| Сертификат OCSP          | Может быть просрочен; должен быть действителен на момент выпуска OCSP-ответа , ,  |

---

### 4. Причина различий

- **OCSP-ответ** — это историческое доказательство, его доверие "заморожено" на момент выпуска.
- **TSP-штамп** — это новое текущее доказательство, и доверие к нему возможно только при действующем сертификате TSA.

---

## Заключение

> **Ключевой вывод:**  
> При перештамповке в CAdES-XL только сертификат TSP (TSA) должен быть действителен и доверен на момент создания нового штампа времени. Сертификат OCSP может быть просрочен, если сам OCSP-ответ был корректно подписан и действителен на момент его выпуска. Это подтверждается стандартами ETSI TS 101 733, RFC 6960 и RFC 3161.

---

### Использованные цитаты

- [ETSI TS 101 733, секции 6.3.2 и 6.4.1](https://tools.ietf.org/html/rfc5126#:~:text=The%20present%20document%20specifies,requirements%20of%20long%2Dterm%20electronic) 
- [RFC 6960, секция 3.2](https://datatracker.ietf.org/doc/html/rfc6960#:~:text=The%20%27revoked%27%20state%20indicates,reason%20is%20certificateHold%29%20or) 
- [ETSI EN 319 411-2](https://www.etsi.org/deliver/etsi_en/319400_319499/31941102/02.06.01_30/en_31941102v020601v.pdf#:~:text=NOTE%203%3A%20CRL%20termination,when%20there%20are%20no) 
- RFC 3161, — дайте знать!**
